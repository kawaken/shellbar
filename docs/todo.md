# Shellbar 開発TODO

## 開発方針
- TDDアプローチで実装
- テストファースト
- Red-Green-Refactorサイクル
- 小さなステップで進める

## Phase 1: 基本的なCLI構造

### 1.1 プロジェクトセットアップ
- [x] go.modの作成
- [x] 基本的なディレクトリ構造の作成

### 1.2 コマンドライン引数パース
- [x] 基本的なコマンド実行引数のパース
- [x] --versionオプション
- [x] 引数なしのエラー（ヘルプ表示）
- [x] 実装: 引数パース処理（flagパッケージ使用）

## Phase 2: 設定管理

### 2.1 設定構造体の定義
- [x] 設定構造体の設計について相談
- [ ] テスト: Config構造体のデフォルト値
- [ ] テスト: TOMLからの読み込み
- [ ] テスト: 部分的な設定の上書き
- [ ] テスト: 設定のバリデーション
- [ ] 実装: 設定構造体

### 2.2 TOML設定ファイル読み込み
- [ ] テスト: 存在しないファイルの場合デフォルト使用
- [ ] テスト: 不正なTOMLのエラーハンドリング
- [ ] テスト: 設定ファイル検索順序
- [ ] 実装: 設定読み込み処理

## Phase 3: コマンド実行基盤

### 3.1 コマンド実行の設計
- [ ] インターフェース設計の検討

### 3.2 実際のコマンド実行
- [ ] テスト: 単純なコマンドの実行（echoなど）
- [ ] テスト: タイムアウト処理
- [ ] テスト: 標準出力の取得
- [ ] テスト: エラー時の動作
- [ ] 実装: コマンド実行処理

## Phase 4: ステータスバー管理

### 4.1 ステータス情報の管理
- [ ] テスト: ステータス情報の初期化
- [ ] テスト: キャッシュの更新
- [ ] テスト: 古いキャッシュの使用
- [ ] 実装: ステータス管理処理

### 4.2 フォーマット文字列の展開
- [ ] テスト: 基本的な変数展開
- [ ] テスト: 複数変数の展開
- [ ] テスト: 未定義変数の処理
- [ ] テスト: エスケープ処理（{{）
- [ ] 実装: フォーマット処理

### 4.3 定期更新メカニズム
- [ ] テスト: 更新間隔の管理
- [ ] テスト: 個別コマンドの更新タイミング
- [ ] テスト: 並行実行の安全性
- [ ] 実装: 定期更新処理

## Phase 5: PTY制御

### 5.1 PTY制御の設計
- [ ] PTY制御の基本概念の理解

### 5.2 実際のPTY制御
- [ ] テスト: PTYの作成（簡単なコマンドで）
- [ ] テスト: ウィンドウサイズの設定
- [ ] テスト: 入出力の転送
- [ ] テスト: Raw modeの設定
- [ ] 実装: PTY制御処理

## Phase 6: 画面制御

### 6.1 ターミナル操作
- [ ] テスト: 画面サイズの取得
- [ ] テスト: カーソル位置の制御
- [ ] テスト: 最下行への描画
- [ ] 実装: ターミナル制御処理

### 6.2 レイアウト管理
- [ ] テスト: メイン領域とステータスバーの分離
- [ ] テスト: リサイズ時の再描画（MVP外だが基本設計）
- [ ] 実装: レイアウト管理処理

## Phase 7: 統合

### 7.1 メインループの実装
- [ ] テスト: 各コンポーネントの統合
- [ ] テスト: シグナルハンドリング
- [ ] テスト: 正常終了処理
- [ ] 実装: main関数の完成

### 7.2 E2Eテスト
- [ ] テスト: 実際のコマンド実行
- [ ] テスト: ステータスバーの表示
- [ ] テスト: 設定ファイルの反映
- [ ] テスト: エラー時の挙動

## Phase 8: リファクタリング

### 8.1 コードの整理
- [ ] 重複コードの除去
- [ ] 設計の見直し
- [ ] エラーハンドリングの統一

### 8.2 テストの改善
- [ ] テストの可読性向上
- [ ] テストの整理
- [ ] カバレッジの確認

## 現在の焦点

**設定ファイルなしで動作する最小構成の実装**

設定ファイル機能は後回しにし、ビルトインコマンドのみで動作する状態を優先的に実装する。

### 次のステップ
1. **ビルトインコマンドのインターフェース設計**
   - Commandインターフェースの定義
   - ビルトインコマンドの基本構造

2. **各ビルトインコマンドの実装**
   - path: 現在のディレクトリパス
   - date: 現在の日付 (YYYY-MM-DD)
   - time: 現在の時刻 (HH:MM:SS)
   - git_branch: 現在のGitブランチ

3. **コマンド実行基盤**
   - コマンド実行とキャッシュ管理
   - タイムアウト処理

4. **フォーマット文字列の展開**
   - {variable} 形式の変数展開
   - デフォルトフォーマットでの表示

5. **最小限のメインループ**
   - ビルトインコマンドのみで動作
   - 設定ファイルなしで起動

### 設計の確定事項
- ビルトインコマンドは設定不要で動作
- デフォルトフォーマット: `{path} {git_branch} | {date} {time}`
- 設定ファイル読み込みは後のフェーズで実装

## 凡例
- [x] 完了
- [ ] 未着手
- 🔄 進行中